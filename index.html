<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ðŸ”¥ Rizz System â€” Version 1 (Phase A)</title>

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
}

.container {
  max-width: 420px;
  margin: auto;
  padding: 20px;
}

h1 {
  font-size: 28px;
  margin-bottom: 12px;
}

input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: none;
  margin-bottom: 10px;
}

button {
  padding: 12px 14px;
  border-radius: 12px;
  border: none;
  font-weight: 600;
  margin: 4px 4px 4px 0;
}

.primary { background: #e5f0ff; }
.secondary { background: #1e1e1e; color: #8ab4ff; }
.warn { background: #ffb300; color: #000; }
.danger { background: #ff6b6b; color: #000; }
.focus { background: #00e676; color: #000; }

.card {
  background: #111;
  border-radius: 16px;
  padding: 14px;
  margin-top: 16px;
}

.progress {
  height: 10px;
  background: #333;
  border-radius: 6px;
  overflow: hidden;
  margin: 8px 0;
}

.bar {
  height: 100%;
  background: linear-gradient(90deg,#00e676,#00c853);
}

.thumb {
  width: 80px;
  border-radius: 8px;
  margin-top: 8px;
}
.small {
  font-size: 13px;
  color: #aaa;
}
</style>
</head>

<body>
<div class="container">
  <h1>ðŸ”¥ Rizz System â€” Version 1 (Phase A)</h1>

  <input id="nameInput" placeholder="Add name (e.g. Charity)" />
  <button class="primary" id="addBtn">Add / Update</button>
  <button class="secondary" id="decayBtn">Run Decay (test)</button>

  <div id="list"></div>
</div>

<input type="file" id="fileInput" accept="image/*" hidden />

<script>
const STORAGE_KEY = "rizz_v1_phaseA";
let data = JSON.parse(localStorage.getItem(STORAGE_KEY) || "{}");
let attachTarget = null;

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function clamp(v) {
  return Math.max(0, Math.min(100, v));
}

function autoFocus() {
  const focused = Object.values(data).filter(p => p.focus);
  const candidates = Object.entries(data)
    .filter(([_,p]) => p.score >= 90 && !p.focus)
    .sort((a,b)=>b[1].score-a[1].score);

  while (focused.length < 2 && candidates.length) {
    candidates.shift()[1].focus = true;
    focused.push(true);
  }
}

function decay() {
  Object.values(data).forEach(p => {
    p.score = clamp(p.score - 10);
  });
  autoFocus();
  save();
  render();
}

function addPerson(name) {
  if (!name) return;
  if (!data[name]) {
    data[name] = { score: 0, focus: false, img: null };
  }
  save();
  render();
}

function updateScore(name, delta) {
  data[name].score = clamp(data[name].score + delta);
  autoFocus();
  save();
  render();
}

function toggleFocus(name) {
  data[name].focus = !data[name].focus;
  autoFocus();
  save();
  render();
}

function attachImage(name) {
  attachTarget = name;
  document.getElementById("fileInput").click();
}

document.getElementById("fileInput").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file || !attachTarget) return;

  const reader = new FileReader();
  reader.onload = () => {
    data[attachTarget].img = reader.result;
    save();
    render();
  };
  reader.readAsDataURL(file);
});

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  Object.entries(data).forEach(([name,p]) => {
    const card = document.createElement("div");
    card.className = "card";

    card.innerHTML = `
      <strong>${name} â€” ${p.score}%</strong>
      ${p.focus ? '<span class="focus" style="margin-left:8px;padding:4px 8px;border-radius:8px;">FOCUS</span>' : ''}
      <div class="progress">
        <div class="bar" style="width:${p.score}%"></div>
      </div>

      <button class="secondary" onclick="updateScore('${name}',-10)">-10</button>
      <button class="secondary" onclick="updateScore('${name}',10)">+10</button>
      <button class="secondary" onclick="toggleFocus('${name}')">
        ${p.focus ? 'Unfocus' : 'Focus'}
      </button>
      <button class="secondary" onclick="attachImage('${name}')">ðŸ“· Attach</button>
      <button class="danger" onclick="delete data['${name}']; save(); render();">Delete</button>

      <div class="small">Prediction: ${p.score >= 90 ? 'Most Likely' : p.score >= 70 ? 'Possible' : 'Low'}</div>
      ${p.img ? `<img src="${p.img}" class="thumb"/>` : ''}
    `;
    list.appendChild(card);
  });
}

document.getElementById("addBtn").onclick = () => {
  addPerson(document.getElementById("nameInput").value.trim());
  document.getElementById("nameInput").value = "";
};

document.getElementById("decayBtn").onclick = decay;

render();
</script>
</body>
</html>