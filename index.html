<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Rizz System Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  margin: 0;
  background: #000;
  color: #fff;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.container {
  max-width: 480px;
  margin: auto;
  padding: 20px;
}

h1 {
  font-size: 32px;
  margin-bottom: 10px;
}

input, button {
  padding: 12px;
  border-radius: 10px;
  border: none;
  font-size: 16px;
}

input {
  width: 100%;
  margin-bottom: 10px;
}

button {
  margin: 4px 4px 4px 0;
  background: #e5e5e5;
  cursor: pointer;
}

button.blue { background: #dbeafe; }
button.red { background: #fecaca; }
button.green { background: #bbf7d0; }

.banner {
  background: #facc15;
  color: #000;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 15px;
  display: none;
}

.card {
  margin-top: 20px;
}

.label {
  display: flex;
  align-items: center;
  gap: 8px;
}

.badge {
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
}

.focus { background: #22c55e; color: #000; }
.active { background: #374151; }
.pause { background: #6b7280; }

.bar {
  background: #333;
  height: 12px;
  border-radius: 10px;
  overflow: hidden;
  margin: 6px 0;
}

.fill {
  height: 100%;
  background: linear-gradient(90deg,#22c55e,#4ade80);
  width: 0%;
}
</style>
</head>

<body>
<div class="container">
  <h1>ðŸ”¥ Rizz System Dashboard</h1>

  <div id="banner" class="banner"></div>

  <input id="nameInput" placeholder="Enter name (e.g. Charity)">
  <button onclick="addOrUpdate()">Add / Update</button>

  <div id="list"></div>
</div>

<script>
const MAX_FOCUS = 2;
const DECAY_DAYS = 2;
const STORAGE_KEY = "rizzSystem";

let state = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];

function save() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

function showBanner(text) {
  const b = document.getElementById("banner");
  b.innerText = text;
  b.style.display = "block";
  setTimeout(() => b.style.display = "none", 4000);
}

function addOrUpdate() {
  const name = nameInput.value.trim();
  if (!name) return;

  let p = state.find(x => x.name === name);
  if (!p) {
    state.push({
      name,
      score: 0,
      status: "active",
      updated: Date.now()
    });
  }
  nameInput.value = "";
  save();
  enforceRules();
  render();
}

function adjust(name, delta) {
  const p = state.find(x => x.name === name);
  if (!p) return;
  p.score = Math.max(0, Math.min(100, p.score + delta));
  p.updated = Date.now();
  enforceRules();
  save();
  render();
}

function setStatus(name, status) {
  const p = state.find(x => x.name === name);
  if (!p) return;
  p.status = status;
  p.updated = Date.now();
  enforceRules();
  save();
  render();
}

function removePerson(name) {
  state = state.filter(x => x.name !== name);
  save();
  render();
}

function applyDecay() {
  const now = Date.now();
  state.forEach(p => {
    const days = (now - p.updated) / (1000 * 60 * 60 * 24);
    if (days >= DECAY_DAYS && p.status !== "focus") {
      p.score = Math.max(0, p.score - 10);
      p.updated = now;
    }
  });
}

function enforceRules() {
  applyDecay();

  // Auto-focus >=90
  state.forEach(p => {
    if (p.score >= 90) p.status = "focus";
  });

  let focused = state.filter(p => p.status === "focus");

  if (focused.length > MAX_FOCUS) {
    focused.sort((a,b) => a.score - b.score);
    while (focused.length > MAX_FOCUS) {
      const demoted = focused.shift();
      demoted.status = "active";
      showBanner("âš  Focus limit reached â€” lowest focus auto-demoted");
    }
  }

  if (focused.length === 0 && state.length) {
    state.sort((a,b) => b.score - a.score);
    state[0].status = "focus";
    showBanner("â„¹ No Focus set â€” system auto-selected");
  }
}

function render() {
  const list = document.getElementById("list");
  list.innerHTML = "";

  state.sort((a,b) => b.score - a.score);

  state.forEach(p => {
    const div = document.createElement("div");
    div.className = "card";

    div.innerHTML = `
      <div class="label">
        <strong>${p.name} â€” ${p.score}%</strong>
        <span class="badge ${p.status}">${p.status.toUpperCase()}</span>
      </div>
      <div class="bar"><div class="fill" style="width:${p.score}%"></div></div>
      <button onclick="adjust('${p.name}',-10)">-10</button>
      <button onclick="adjust('${p.name}',10)">+10</button>
      <button class="blue" onclick="setStatus('${p.name}','focus')">Focus</button>
      <button onclick="setStatus('${p.name}','pause')">Pause</button>
      <button onclick="setStatus('${p.name}','active')">Active</button>
      <button class="red" onclick="removePerson('${p.name}')">Delete</button>
    `;
    list.appendChild(div);
  });
}

enforceRules();
render();
</script>
</body>
</html>